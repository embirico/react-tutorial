<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Gabe</title>
    <!-- Not present in the tutorial. Just for basic styling. -->
    <link rel="stylesheet" href="css/bootstrap.3.3.6.min.css" />
    <link rel="stylesheet" href="css/base.css" />
    <link rel="stylesheet" href="css/main.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.7/react.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.7/react-dom.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.6.15/browser.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
  </head>
  <body>
    <div id="content"></div>
    <script type="text/babel">
      // To get started with this tutorial running your own code, simply remove
      // the script tag loading scripts/example.js and start writing code here.
      var Nav = React.createClass({
        render: function() {
          return (
            <nav className='navbar navbar-default'>
              <div className='container'>
                <div className='navbar-header navbar-center'>
                  <p className='navbar-text'>
                    Path Explorer
                  </p>
                </div>
              </div>
            </nav>
          );
        }
      });

      var PlayerContainer = React.createClass({
        getInitialState: function() {
          return {player: null};
        },
        getAllData: function () {
          if (!this.state.player) {
            return []
          }
          return []; // TODO ajax
        },
        componentDidMount: function() {
          this.setState({player: 'Stephen Curry'});
        },
        triggerPlayerChange: function(player) {
          this.setState({player: player});
        },
        render: function() {
          return (
            <div className="playerContainer container">
              <PathContainer
                player={this.state.player}
                allData={this.getAllData}
                triggerPlayerChange={this.triggerPlayerChange}
              />
            </div>
          )
        }
      });

      var PathContainer = React.createClass({
        selectedData: null,
        getInitialState: function() {
          return {offDef: 'off', gridSel: [], playerSelectActive: false}
        },
        getNumPossessions: function() {
          return 12; // TODO
        },
        getFGPercent: function() {
          return 40; // TODO
        },
        getHistogramData: function() {
          return 'histogram'; // TODO
        },
        toggleOffDef: function() {
          var newOffDef = this.state.offDef == 'off' ? 'def' : 'off';
          // this.setState({offDef: newOffDef});
        },

        render: function() {
          return (
            <div className="col-lg-8 col-lg-offset-2 pathContainer">
              <Header
                triggerPlayerChange={this.props.triggerPlayerChange}
                player={this.props.player}
                offDef={this.state.offDef}
                toggleOffDef={this.toggleOffDef()}
              />
              {this.state.playerSelectActive ? <PlayerSelectContainer /> : <CourtContainer />}
              <StatsContainer
                numPossessions={this.getNumPossessions()}
                fGPercent={this.getFGPercent()}
                histogramData={this.getHistogramData()}
              />
            </div>
          );
        }
      });

      var Header = React.createClass({
        render: function() {
          return (
            <div className="header row">
              <ChangePlayerBtn triggerPlayerChange={this.props.triggerPlayerChange} />
              <TitlePlayerName player={this.props.player} />
              <OffDefToggle offDef={this.props.offDef} toggleOffDef={this.props.toggleOffDef} />
            </div>
          );
        }
      });

      var ChangePlayerBtn = React.createClass({
        handleClick: function(e) {
          e.preventDefault();
          this.props.triggerPlayerChange();
        },
        render: function() {
          return (
            <div className='col-lg-2'>
              <svg className='change-player-icon' onClick={this.handleClick}></svg>
            </div>
          );
        }
      });

      var TitlePlayerName = React.createClass({
        render: function() {
          return (
            <div className='col-lg-8 player-title'>{this.props.player}</div>
          )
        }
      });

      var OffDefToggle = React.createClass({
        render: function() {
          return (
            <div className='col-lg-2'>
              <OffDefToggleBtn
                selected={this.props.offDef == 'off'}
                toggleOffDef={this.props.toggleOffDef}
              >
                Offense
              </OffDefToggleBtn>
              <OffDefToggleBtn
                selected={this.props.offDef == 'def'}
                toggleOffDef={this.props.toggleOffDef}
              >
                Defense
              </OffDefToggleBtn>
            </div>
          );
        }
      });

      var OffDefToggleBtn = React.createClass({
        getClassName: function() {
          return this.props.selected ? 'offdef-tgl-btn tgl-selected' : 'offdef-tgl-btn';
        },
        handleClick: function(e) {
          e.preventDefault();
          this.props.toggleOffDef();
        },
        render: function() {
          return (
            <div className={this.getClassName()} onClick={this.handleClick}>
              {this.props.children}
            </div>
          );
        }
      });

      var CourtContainer = React.createClass({
        render: function() {
          return (
            <div className='court-container'>
              <ClickGrid />
              <Canvas />
            </div>
          )
        }
      });

      var ClickGrid = React.createClass({
        render: function() {
          return (
            <svg className='court-grid'></svg>
          );
        }
      });

      var Canvas = React.createClass({
        render: function() {
          return (
            <canvas className='court-canvas'></canvas>
          );
        }
      });

      var PlayerSelectContainer = React.createClass({
        data: null,
        getData: function() {

        },
        render: function() {
          return (
            <div>
              <SearchBar />
              <SelectionContainer data={this.data} />
            </div>
          );
        }
      });

      var SearchBar = React.createClass({
        // Stick Lunr here?
        render: function() {
          return (
            <input type='text' value='Search'>
            </input>
          )
        }
      });

      var SelectionContainer = React.createClass({
        render: function() {
          const Teams = this.props.data.map(function(obj) {
            var teamName = obj.teamName;
            var players = obj.players;
            return <TeamContainer teamName={teamName} players={players} />
          });

          return (
            <div class='selection-container'>
              {Teams}
            </div>
          );
        }
      });

      var TeamContainer = React.createClass({
        render: function() {
          const PlayerNames = this.props.players.map(function(name, i) {
            return <SelectPlayerName name={name} key={i} />
          });

          return (
            <div>
              <TeamIcon teamName={this.props.teamName} />
              {PlayerNames}
            </div>
          );
        }
      })

      var TeamIcon = React.createClass({
        render: function() {
          return (
            <div>
              <span className='team-name'>{this.props.teamName}</span>
            </div>
          );
        }
      });

      var SelectPlayerName = React.createClass({
        render: function() {
          return (
            <div className='select-player-name'>
              {this.props.name}
            </div>
          );
        }
      });

      var StatsContainer = React.createClass({
        render: function() {
          return (
            <div className="row stats-container">
              <PossessionsCount count={this.props.numPossessions} />
              <PossessionsFG percent={this.props.fGPercent} />
              <Histogram data={this.props.histogramData} />
            </div>
          )
        }
      });

      var PossessionsCount = React.createClass({
        render: function() {
          return (
            <div className="col-lg-3 stats-poss">
              <h2>{this.props.count}</h2>
              <p>Num possessions</p>
            </div>
          )
        }
      });

      var PossessionsFG = React.createClass({
        render: function() {
          return (
            <div className="col-lg-3 stats-poss">
              <h2>{this.props.percent}</h2>
              <p>Percent of field goals made</p>
            </div>
          )
        }
      });

      var Histogram = React.createClass({
        render: function() {
          return (
            <div className="col-lg-6">
              <h2>Histogram</h2>
            </div>
          )
        }
      });

      ReactDOM.render(
        <div>
          <Nav />
          <PlayerContainer />
        </div>,
        document.getElementById('content')
      );

    </script>
  </body>
</html>
